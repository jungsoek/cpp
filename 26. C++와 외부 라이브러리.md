# 26. C++ì™€ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬

## Boost ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©ë²•

### 1. ğŸ¯ Boostë€?

> **Boost**ëŠ” C++ í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™•ì¥í•˜ëŠ” ê³ í’ˆì§ˆ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì§‘í•©ì´ì•¼.
>  ë§ì€ Boost êµ¬ì„± ìš”ì†Œê°€ **C++ í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬(STL)**ë¡œ ì±„íƒë˜ê¸°ë„ í–ˆì§€ (ì˜ˆ: `shared_ptr`, `regex`, `filesystem`).

#### Boostì˜ íŠ¹ì§•:

| íŠ¹ì§•                           | ì„¤ëª…                                 |
| ------------------------------ | ------------------------------------ |
| ëª¨ë“ˆì‹ êµ¬ì„±                    | ì•½ 160ê°œ ì´ìƒì˜ ë…ë¦½ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬    |
| C++ í‘œì¤€ í›„ë³´                  | `std::`ë¡œ ì±„íƒëœ ëª¨ë“ˆ ë‹¤ìˆ˜           |
| í—¤ë” ì „ìš© + ë°”ì´ë„ˆë¦¬ ë¹Œë“œ ë³‘ì¡´ | ì¼ë¶€ëŠ” header-only, ì¼ë¶€ëŠ” ë¹Œë“œ í•„ìš” |
| ê³ ì„±ëŠ¥, í…œí”Œë¦¿ ê¸°ë°˜            | Generic Programming, TMP ê¸°ë°˜        |

### 2. ğŸ›  ì„¤ì¹˜

#### Ubuntu

```
sudo apt install libboost-all-dev
```

#### Mac (Homebrew)

```
brew install boost
```

#### ìˆ˜ë™ ì„¤ì¹˜ (ì†ŒìŠ¤)

```
wget https://boostorg.jfrog.io/artifactory/main/release/1.84.0/source/boost_1_84_0.tar.gz
tar -xf boost_1_84_0.tar.gz
cd boost_1_84_0
./bootstrap.sh
./b2
```

â†’ ë¹Œë“œ í›„, `stage/lib`ì— `.a`, `.so` íŒŒì¼ ìƒì„±ë¨

### 3. ğŸ“¦ ê¸°ë³¸ êµ¬ì¡°

#### í—¤ë” ì „ìš© ë¼ì´ë¸ŒëŸ¬ë¦¬ (ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥)

- `boost/any.hpp`
- `boost/optional.hpp`
- `boost/algorithm/string.hpp`
- `boost/lexical_cast.hpp`
- `boost/variant.hpp`
- `boost/asio.hpp` (ë‹¨ì¼ ìŠ¤ë ˆë“œì¼ ê²½ìš°)
- `boost/filesystem.hpp` (C++17 ì´ìƒì€ `<filesystem>`ë¡œ ëŒ€ì²´ë¨)

#### ë¹Œë“œê°€ í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬

- `boost::thread`
- `boost::system`
- `boost::regex`
- `boost::chrono`
- `boost::serialization`
- `boost::python`
- `boost::log`

### 4. âœï¸ ì˜ˆì œ 1: `boost::filesystem`

```
#include <boost/filesystem.hpp>
#include <iostream>

namespace fs = boost::filesystem;

int main() {
    fs::path path = "/tmp";
    if (fs::exists(path) && fs::is_directory(path)) {
        for (const auto& entry : fs::directory_iterator(path)) {
            std::cout << entry.path() << "\n";
        }
    }
}
```

#### ì»´íŒŒì¼

```
g++ -std=c++17 main.cpp -lboost_filesystem -lboost_system
```

### 5. âœï¸ ì˜ˆì œ 2: `boost::asio` (ë¹„ë™ê¸° ë„¤íŠ¸ì›Œí‚¹)

```
#include <boost/asio.hpp>
#include <iostream>

int main() {
    boost::asio::io_context io;
    boost::asio::steady_timer timer(io, boost::asio::chrono::seconds(3));
    timer.async_wait([](const boost::system::error_code&){
        std::cout << "íƒ€ì´ë¨¸ ë§Œë£Œ!\n";
    });
    io.run();
}
```

### 6. âœï¸ ì˜ˆì œ 3: `boost::optional`

```
#include <boost/optional.hpp>
#include <iostream>

boost::optional<int> maybe_get(bool ok) {
    if (ok) return 42;
    else return boost::none;
}

int main() {
    auto val = maybe_get(true);
    if (val) std::cout << *val << "\n";
}
```

### 7. ğŸ§ª ì£¼ìš” Boost ë¼ì´ë¸ŒëŸ¬ë¦¬ ëª©ë¡

| ì´ë¦„                  | ì„¤ëª…                              |
| --------------------- | --------------------------------- |
| `Boost.Asio`          | ë¹„ë™ê¸° ì…ì¶œë ¥ (ì†Œì¼“, íƒ€ì´ë¨¸ ë“±)   |
| `Boost.Filesystem`    | íŒŒì¼ ì‹œìŠ¤í…œ ê²½ë¡œ ì¡°ì‘             |
| `Boost.Optional`      | `std::optional` ëŒ€ì²´ / ì„ ë„       |
| `Boost.Any`           | ì„ì˜ íƒ€ì… ì €ì¥ (`std::any` ëŒ€ì²´)  |
| `Boost.Variant`       | ë‹¤í˜•ì  íƒ€ì… (`std::variant` ëŒ€ì²´) |
| `Boost.Regex`         | ì •ê·œ í‘œí˜„ì‹ (`std::regex` ì´ì „)   |
| `Boost.Thread`        | ë©€í‹°ìŠ¤ë ˆë”©                        |
| `Boost.Log`           | ë¡œê¹… í”„ë ˆì„ì›Œí¬                   |
| `Boost.Serialization` | ê°ì²´ ì§ë ¬í™”                       |
| `Boost.Python`        | Python â†” C++ ì—°ë™                 |
| `Boost.Graph`         | ê·¸ë˜í”„ ìë£Œêµ¬ì¡° ë° ì•Œê³ ë¦¬ì¦˜       |

### 8. ğŸ”— CMakeì—ì„œ Boost ì‚¬ìš©ë²•

```
find_package(Boost REQUIRED COMPONENTS filesystem system)

add_executable(myapp main.cpp)
target_link_libraries(myapp Boost::filesystem Boost::system)
```

> `Boost_INCLUDE_DIRS`, `Boost_LIBRARIES`ë„ ìˆ˜ë™ìœ¼ë¡œ ì“¸ ìˆ˜ ìˆìŒ

### 9. âš ï¸ ì£¼ì˜ì‚¬í•­

| í•­ëª©           | ì„¤ëª…                                               |
| -------------- | -------------------------------------------------- |
| ë¹Œë“œ í•„ìš” ì—¬ë¶€ | ì¼ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë°˜ë“œì‹œ `b2` ë¹Œë“œ í•„ìš”            |
| ë²„ì „ í˜¸í™˜ì„±    | ì¼ë¶€ ì‹œìŠ¤í…œì—ì„œëŠ” gcc/clang ë²„ì „ ì œí•œ ìˆìŒ         |
| ì¤‘ë³µ ê¸°ëŠ¥      | C++17 ì´ìƒì—ì„œëŠ” ë§ì€ Boost ê¸°ëŠ¥ì´ í‘œì¤€ìœ¼ë¡œ í¬í•¨ë¨ |

### âœ… ìš”ì•½

| í•­ëª©                | ì„¤ëª…                                                         |
| ------------------- | ------------------------------------------------------------ |
| Boostë€?            | í‘œì¤€ C++ í™•ì¥ì„ ìœ„í•œ ê³ í’ˆì§ˆ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì§‘í•©                  |
| ì„¤ì¹˜ ë°©ë²•           | `apt`, `brew`, ì†ŒìŠ¤ ë¹Œë“œ ê°€ëŠ¥                                |
| í—¤ë” ì „ìš© vs ë¹Œë“œí˜• | `optional`, `any` ë“±ì€ í—¤ë” ì „ìš©, `thread`, `regex` ë“±ì€ ë¹Œë“œ í•„ìš” |
| ì£¼ìš” ìš©ë„           | íŒŒì¼ ì‹œìŠ¤í…œ, ë„¤íŠ¸ì›Œí‚¹, ì§ë ¬í™”, ìˆ˜í•™, íŒŒì„œ, ë¡œê·¸, ìŠ¤ë ˆë“œ ë“±   |

## CMakeë¥¼ í†µí•œ ì™¸ë¶€ í”„ë¡œì íŠ¸ í†µí•©

### 1. ğŸ¯ ì™¸ë¶€ í”„ë¡œì íŠ¸ í†µí•©ì´ë€?

> CMake ê¸°ë°˜ C++ í”„ë¡œì íŠ¸ì—ì„œ ë‹¤ë¥¸ ë¼ì´ë¸ŒëŸ¬ë¦¬(ì˜ˆ: Boost, fmt, spdlog ë“±)ë¥¼
>  **ë¹Œë“œ ì‹œì  ë˜ëŠ” ì„¤ì¹˜ëœ ë²„ì „ìœ¼ë¡œ ì—°ë™í•˜ëŠ” ë°©ì‹**

ì£¼ìš” ë°©ì‹ 3ê°€ì§€:

| ë°©ì‹                   | ì„¤ëª…                                                |
| ---------------------- | --------------------------------------------------- |
| 1ï¸âƒ£ `find_package()`     | ì‹œìŠ¤í…œì— ì„¤ì¹˜ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©                     |
| 2ï¸âƒ£ `add_subdirectory()` | ì†ŒìŠ¤ ì½”ë“œ ì§ì ‘ í¬í•¨ (header-only í¬í•¨)              |
| 3ï¸âƒ£ `FetchContent`       | ì™¸ë¶€ Git ì €ì¥ì†Œë¥¼ CMakeê°€ ìë™ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ í›„ í¬í•¨ |

### 2. âœ… ë°©ì‹ 1: `find_package()` â€” ì„¤ì¹˜ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©

```
# CMakeLists.txt
find_package(fmt REQUIRED)

add_executable(myapp main.cpp)
target_link_libraries(myapp PRIVATE fmt::fmt)
```

#### íŠ¹ì§•

| í•­ëª©      | ì„¤ëª…                                                       |
| --------- | ---------------------------------------------------------- |
| ì „ì œ ì¡°ê±´ | `fmt`ê°€ ì‹œìŠ¤í…œì— ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•¨                        |
| ì‚¬ìš© ìœ„ì¹˜ | `/usr/include`, `/usr/lib` ë˜ëŠ” `CMAKE_PREFIX_PATH`ë¡œ ì§€ì • |
| ì¥ì       | ë¹ ë¥´ê³  ê¹”ë”                                                |
| ë‹¨ì       | ì„¤ì¹˜ë˜ì§€ ì•Šìœ¼ë©´ ì˜¤ë¥˜ ë°œìƒ, ì´ì‹ì„± ë–¨ì–´ì§                   |

### 3. âœ… ë°©ì‹ 2: `add_subdirectory()` â€” ì†ŒìŠ¤ ì½”ë“œ í¬í•¨

```
your_project/
â”œâ”€â”€ CMakeLists.txt
â”œâ”€â”€ main.cpp
â””â”€â”€ external/
    â””â”€â”€ fmt/  â† fmt ì „ì²´ ì†ŒìŠ¤ clone
cmakeì½”ë“œ ë³µì‚¬# CMakeLists.txt
add_subdirectory(external/fmt)

add_executable(myapp main.cpp)
target_link_libraries(myapp PRIVATE fmt::fmt)
```

#### íŠ¹ì§•

| í•­ëª©             | ì„¤ëª…                               |
| ---------------- | ---------------------------------- |
| ì˜ì¡´ì„± ì§ì ‘ í¬í•¨ | ì„œë¸Œëª¨ë“ˆ ë˜ëŠ” ë³µì‚¬ë¡œ êµ¬ì„±          |
| ì†ŒìŠ¤ ë¹Œë“œ í¬í•¨ë¨ | ì‚¬ìš©ìê°€ ë³„ë„ ì„¤ì¹˜ ì•ˆ í•´ë„ ë¨      |
| ì¥ì              | ì´ì‹ì„± ë†’ìŒ                        |
| ë‹¨ì              | í”„ë¡œì íŠ¸ í¬ê¸° ì¦ê°€, ê´€ë¦¬ ë¹„ìš© ìˆìŒ |

### 4. âœ… ë°©ì‹ 3: `FetchContent` â€” ìë™ ë‹¤ìš´ë¡œë“œ & ë¹Œë“œ

```
include(FetchContent)

FetchContent_Declare(
  fmt
  GIT_REPOSITORY https://github.com/fmtlib/fmt.git
  GIT_TAG 10.1.1
)

FetchContent_MakeAvailable(fmt)

add_executable(myapp main.cpp)
target_link_libraries(myapp PRIVATE fmt::fmt)
```

#### íŠ¹ì§•

| í•­ëª©               | ì„¤ëª…                            |
| ------------------ | ------------------------------- |
| ìë™ ë‹¤ìš´ë¡œë“œ      | Gitì—ì„œ ì§€ì •ëœ ë²„ì „ ì²´í¬ì•„ì›ƒ    |
| CMake >= 3.11 í•„ìš” | `FetchContent`ì€ ë‚´ì¥ ëª¨ë“ˆ      |
| ì¥ì                | ìë™í™”, CI/CDì— ì í•©            |
| ë‹¨ì                | ë¹Œë“œ ì‹œê°„ ì¦ê°€, ë„¤íŠ¸ì›Œí¬ ì˜ì¡´ì„± |

### 5. ğŸ“¦ ì‹¤ì œ í”„ë¡œì íŠ¸ ì˜ˆ: fmt + spdlog + GoogleTest

```
cmake_minimum_required(VERSION 3.16)
project(MyProject)

include(FetchContent)

# Fetch fmt
FetchContent_Declare(fmt
  GIT_REPOSITORY https://github.com/fmtlib/fmt.git
  GIT_TAG 10.1.1
)
FetchContent_MakeAvailable(fmt)

# Fetch spdlog (fmt í•„ìš”)
FetchContent_Declare(spdlog
  GIT_REPOSITORY https://github.com/gabime/spdlog.git
  GIT_TAG v1.13.0
)
FetchContent_MakeAvailable(spdlog)

# Executable
add_executable(myapp main.cpp)
target_link_libraries(myapp PRIVATE spdlog::spdlog)
```

### 6. ğŸ›  íŒ: `CMAKE_PREFIX_PATH` ì„¤ì •

ì„¤ì¹˜ëœ ì™¸ë¶€ íŒ¨í‚¤ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ì„ ë•Œ:

```
cmake -DCMAKE_PREFIX_PATH=/opt/mylibs ..
```

- CMakeê°€ `.cmake` ì„¤ì • íŒŒì¼ì„ í•´ë‹¹ ê²½ë¡œì—ì„œ ì°¾ë„ë¡ ë„ì™€ì¤Œ

### 7. ğŸ§ª ë¹Œë“œ & ì‹¤í–‰

```
mkdir build && cd build
cmake ..
make
./myapp
```

### âœ… ìš”ì•½ ë¹„êµ

| ë°©ì‹                 | ì¥ì            | ë‹¨ì                 | ì¶”ì²œ ìƒí™©             |
| -------------------- | -------------- | ------------------- | --------------------- |
| `find_package()`     | ë¹ ë¦„, í‘œì¤€ì    | ì„¤ì¹˜ í•„ìš”           | ì‹œìŠ¤í…œ ì„¤ì¹˜ í™˜ê²½      |
| `add_subdirectory()` | ì•ˆì •ì , ì´ì‹ì„± | ê´€ë¦¬ ë¹„ìš©           | ë‚´ë¶€ í”„ë¡œì íŠ¸ í¬í•¨ ì‹œ |
| `FetchContent`       | ìë™í™”, ìµœì‹ í™” | ëŠë¦¼, ë„¤íŠ¸ì›Œí¬ í•„ìš” | CI, ë‹¤ì¤‘ í”„ë¡œì íŠ¸     |

## ì™¸ë¶€ C í•¨ìˆ˜ì˜ ì—°ê²° (extern "C")

### 1. ğŸ¯ `extern "C"`ë€?

> `extern "C"`ëŠ” C++ì—ì„œ **C ì–¸ì–´ ìŠ¤íƒ€ì¼ì˜ ë§í‚¹ ë°©ì‹**ì„ ì‚¬ìš©í•˜ê² ë‹¤ëŠ” ì˜ë¯¸ì•¼.

ğŸ“Œ C++ì€ **í•¨ìˆ˜ ì˜¤ë²„ë¡œë”©**ì„ ì§€ì›í•˜ê¸° ë•Œë¬¸ì— ì»´íŒŒì¼ ì‹œ í•¨ìˆ˜ ì´ë¦„ì´ **name mangling(ì´ë¦„ ë³€í˜•)**ë¨.
 CëŠ” ì˜¤ë²„ë¡œë”©ì´ ì—†ê¸° ë•Œë¬¸ì— ì´ë¦„ì´ ê·¸ëŒ€ë¡œ ìœ ì§€ë¨.

â†’ `extern "C"`ë¥¼ ì‚¬ìš©í•˜ë©´ C++ ì»´íŒŒì¼ëŸ¬ê°€ **C ë°©ì‹ìœ¼ë¡œ í•¨ìˆ˜ ì´ë¦„ì„ ìœ ì§€**í•¨.

### 2. âš™ï¸ ì´ë¦„ ë³€í˜• ì˜ˆì‹œ (Name Mangling)

```
// C++
int sum(int a, int b) { return a + b; }
// â†’ ë‚´ë¶€ ì‹¬ë³¼ ì´ë¦„: _Z3sumii
```

```
// C
int sum(int a, int b) { return a + b; }
// â†’ ë‚´ë¶€ ì‹¬ë³¼ ì´ë¦„: sum
```

ğŸ”´ C++ì—ì„œ C í•¨ìˆ˜ë¥¼ ê·¸ëŒ€ë¡œ `#include`í•˜ë©´ ì´ë¦„ ë¶ˆì¼ì¹˜ë¡œ **ë§ì»¤ ì—ëŸ¬ ë°œìƒ**
 â†’ ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ê²Œ `extern "C"`ì•¼.

### 3. âœ… C++ ì½”ë“œì—ì„œ C í•¨ìˆ˜ í˜¸ì¶œ

#### ì˜ˆ: C ë¼ì´ë¸ŒëŸ¬ë¦¬ (sum.c)

```
// sum.h
int sum(int a, int b);

// sum.c
int sum(int a, int b) {
    return a + b;
}
```

#### C++ì—ì„œ ì‚¬ìš©

```
// main.cpp
extern "C" {
#include "sum.h"
}

#include <iostream>

int main() {
    std::cout << "sum: " << sum(3, 4) << "\n";
}
```

#### ë¹Œë“œ

```
gcc -c sum.c
g++ main.cpp sum.o -o main
```

### 4. â˜‘ï¸ C í—¤ë”ì—ì„œ ì•ˆì „í•˜ê²Œ `extern "C"` ì²˜ë¦¬í•˜ëŠ” ë°©ë²•

í—¤ë” íŒŒì¼ì„ Cì™€ C++ ëª¨ë‘ì—ì„œ ì•ˆì „í•˜ê²Œ ì“°ë ¤ë©´:

```
// sum.h
#ifndef SUM_H
#define SUM_H

#ifdef __cplusplus
extern "C" {
#endif

int sum(int a, int b);

#ifdef __cplusplus
}
#endif

#endif
```

ì´ë ‡ê²Œ í•˜ë©´ **C++ì—ì„œë„ ë¬¸ì œì—†ì´ include ê°€ëŠ¥**í•˜ë©´ì„œ,
 C ì»´íŒŒì¼ëŸ¬ì—ì„œëŠ” ì•„ë¬´ ì˜í–¥ë„ ì—†ì–´.

### 5. ğŸ§  ì‘ìš©: C ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ C++ì—ì„œ ì—°ë™

| í•­ëª©                                    | ì„¤ëª…                               |
| --------------------------------------- | ---------------------------------- |
| SQLite                                  | `extern "C"`ë¡œ C API í—¤ë” ë¶ˆëŸ¬ì˜´   |
| libcurl                                 | C APIì§€ë§Œ C++ì—ì„œ ì‰½ê²Œ ì‚¬ìš© ê°€ëŠ¥   |
| POSIX ì‹œìŠ¤í…œ ì½œ (`unistd.h`, `fcntl.h`) | ëª¨ë‘ C API â†’ `extern "C"`ë¡œ ë§í‚¹ë¨ |

### 6. ğŸ›‘ `extern "C"` ì£¼ì˜ì‚¬í•­

| í•­ëª©         | ì£¼ì˜ ë‚´ìš©                                            |
| ------------ | ---------------------------------------------------- |
| í•¨ìˆ˜ë§Œ ê°€ëŠ¥  | í´ë˜ìŠ¤, ë„¤ì„ìŠ¤í˜ì´ìŠ¤, ì˜¤ë²„ë¡œë”© ë¶ˆê°€                  |
| ì˜¤ë²„ë¡œë”© X   | CëŠ” ì˜¤ë²„ë¡œë”© ì§€ì›í•˜ì§€ ì•ŠìŒ                           |
| ë§ì»¤ë§Œ ê´€ì—¬  | `extern "C"`ëŠ” ì»´íŒŒì¼ ê²°ê³¼ì˜ ì‹¬ë³¼ ì´ë¦„ì—ë§Œ ì˜í–¥      |
| extern "C++" | ê±°ì˜ ì“°ì´ì§€ ì•ŠìŒ. C++ ì‹¬ë³¼ì„ ë‹¤ì‹œ ê°•ì œí™”í•  ë•Œë§Œ ì‚¬ìš© |

### 7. âœï¸ ë°˜ëŒ€ ë°©í–¥: Cì—ì„œ C++ í˜¸ì¶œì€?

1. C++ í•¨ìˆ˜ë¥¼ `extern "C"`ë¡œ ì„ ì–¸
2. `C`ì—ì„œ í•´ë‹¹ `.h` íŒŒì¼ì„ `#include`
3. ì»´íŒŒì¼ ì‹œ `g++`ë¡œ ë§í¬ í•„ìš”

```
// cppfunc.h
#ifdef __cplusplus
extern "C" {
#endif

void hello_cpp();

#ifdef __cplusplus
}
#endif
```

```
// cppfunc.cpp
#include <iostream>
void hello_cpp() {
    std::cout << "Hello from C++\n";
}
```

```
// main.c
#include "cppfunc.h"
int main() {
    hello_cpp();
    return 0;
}
```

```
g++ -c cppfunc.cpp
gcc -c main.c
g++ cppfunc.o main.o -o mixed
```

### âœ… ìš”ì•½

| í•­ëª©             | ì„¤ëª…                                                         |
| ---------------- | ------------------------------------------------------------ |
| ëª©ì              | C++ì—ì„œ C í•¨ìˆ˜/ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ **ë§ì»¤ ì¶©ëŒ ì—†ì´ ì‚¬ìš©**          |
| ë¬¸ë²•             | `extern "C" { ... }`                                         |
| í•µì‹¬ íš¨ê³¼        | C++ì˜ name mangling ë¹„í™œì„±í™”                                 |
| ì‹¤ì „ ì˜ˆ          | POSIX, SQLite, OpenGL, libcurl, Cë¡œ ëœ DSP/ìˆ˜í•™ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë“± |
| ì•ˆì „í•œ í—¤ë” ì²˜ë¦¬ | `#ifdef __cplusplus ... extern "C" ... #endif` ì‚¬ìš©          |

## ë™ì  ë¼ì´ë¸ŒëŸ¬ë¦¬ (.dll/.so) ë¡œë”©

### 1. ğŸ¯ ë™ì  ë¡œë”©ì´ë€?

> ì»´íŒŒì¼ ì‹œê°€ ì•„ë‹ˆë¼ **ì‹¤í–‰ ì‹œê°„(runtime)ì— ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¡œë“œ**í•˜ê³ ,
>  ê·¸ ì•ˆì˜ í•¨ìˆ˜ë‚˜ ê°ì²´ë¥¼ **ë™ì ìœ¼ë¡œ í˜¸ì¶œí•˜ëŠ” ê¸°ë²•**

ğŸ“Œ ë™ì  ë¡œë”©ì„ ì‚¬ìš©í•˜ë©´:

- **í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ êµ¬í˜„** ê°€ëŠ¥
- ëŸ°íƒ€ì„ ì¡°ê±´ì— ë”°ë¼ **ìœ ì—°í•˜ê²Œ ë¡œë”©/êµì²´** ê°€ëŠ¥
- **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ìµœì†Œí™”**, í•„ìš”í•  ë•Œë§Œ ë¡œë“œ

### 2. âš™ï¸ í•µì‹¬ í•¨ìˆ˜ ë¹„êµ

| í”Œë«í¼       | ë¼ì´ë¸ŒëŸ¬ë¦¬ | ë¡œë”© í•¨ìˆ˜       | ì‹¬ë³¼ ê²€ìƒ‰          | ì–¸ë¡œë“œ          |
| ------------ | ---------- | --------------- | ------------------ | --------------- |
| Linux / Unix | `.so`      | `dlopen()`      | `dlsym()`          | `dlclose()`     |
| Windows      | `.dll`     | `LoadLibrary()` | `GetProcAddress()` | `FreeLibrary()` |

### 3. ğŸ§ Linux / Unix (`.so`) ì‚¬ìš© ì˜ˆ

#### ğŸ”§ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì •ì˜ (libmathops.so)

```
// mathops.cpp
extern "C" int add(int a, int b) {
    return a + b;
}
```

```
g++ -fPIC -shared -o libmathops.so mathops.cpp
```

> `-fPIC`ì€ ìœ„ì¹˜ ë…ë¦½ ì½”ë“œ, `-shared`ëŠ” `.so` ìƒì„±

#### ğŸ§© ë¡œë”© ì½”ë“œ

```
// main.cpp
#include <dlfcn.h>
#include <iostream>

typedef int (*add_func)(int, int);

int main() {
    void* handle = dlopen("./libmathops.so", RTLD_LAZY);
    if (!handle) {
        std::cerr << "dlopen failed: " << dlerror() << "\n";
        return 1;
    }

    add_func add = (add_func)dlsym(handle, "add");
    if (!add) {
        std::cerr << "dlsym failed: " << dlerror() << "\n";
        return 1;
    }

    std::cout << "3 + 4 = " << add(3, 4) << "\n";
    dlclose(handle);
    return 0;
}

```

```
g++ main.cpp -ldl -o dynamic_loader
./dynamic_loader
```

### 4. ğŸªŸ Windows (`.dll`) ì‚¬ìš© ì˜ˆ

#### ë¼ì´ë¸ŒëŸ¬ë¦¬ ìƒì„±

```
// mathops.cpp
extern "C" __declspec(dllexport) int add(int a, int b) {
    return a + b;
}
```

```
cl /LD mathops.cpp  // ìƒì„±: mathops.dll
```

#### ë¡œë”© ì½”ë“œ

```
#include <windows.h>
#include <iostream>

typedef int (*add_func)(int, int);

int main() {
    HMODULE lib = LoadLibraryA("mathops.dll");
    if (!lib) {
        std::cerr << "DLL Load failed\n";
        return 1;
    }

    add_func add = (add_func)GetProcAddress(lib, "add");
    if (!add) {
        std::cerr << "Function load failed\n";
        return 1;
    }

    std::cout << "3 + 4 = " << add(3, 4) << "\n";
    FreeLibrary(lib);
    return 0;
}
```

### 5. ğŸ§  RTLD_LAZY vs RTLD_NOW

| ì˜µì…˜        | ì˜ë¯¸                                         |
| ----------- | -------------------------------------------- |
| `RTLD_LAZY` | ì‹¬ë³¼ì´ ì‹¤ì œë¡œ ì‚¬ìš©ë  ë•Œ í•´ì„ë¨ (ê²Œìœ¼ë¥¸ ë¡œë”©) |
| `RTLD_NOW`  | `dlopen()` í˜¸ì¶œ ì‹œ **ëª¨ë“  ì‹¬ë³¼ ì¦‰ì‹œ í•´ì„**   |

### 6. ğŸ“¦ ì‹¬ë³¼ ì´ë¦„ ì£¼ì˜

- **C++ í•¨ìˆ˜ëŠ” name mangling ë°œìƒ** â†’ ë°˜ë“œì‹œ `extern "C"` í•„ìš”!
- `nm libyourlib.so`ë¡œ í•¨ìˆ˜ ì´ë¦„ í™•ì¸ ê°€ëŠ¥

### 7. ğŸ§ª ì‹¤ì „ íŒ

| í•­ëª©                   | ì„¤ëª…                                                 |
| ---------------------- | ---------------------------------------------------- |
| `LD_LIBRARY_PATH`      | `.so`ë¥¼ ì°¾ì„ ê²½ë¡œ ì„¤ì • (`export LD_LIBRARY_PATH=./`) |
| `dlerror()`            | ë§ˆì§€ë§‰ ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸                              |
| `RTLD_GLOBAL`          | ì „ì—­ ì‹¬ë³¼ë¡œ ë“±ë¡ (ë‹¤ë¥¸ `dlopen` ëª¨ë“ˆì—ì„œ ì°¸ì¡° ê°€ëŠ¥)  |
| `plugin_dir/*.so` ìˆœíšŒ | í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ êµ¬ì„± ê°€ëŠ¥                            |

### 8. ğŸ§° ê³ ê¸‰ ì‚¬ìš©: í•¨ìˆ˜ ìë™ ë“±ë¡ (í”ŒëŸ¬ê·¸ì¸ êµ¬ì¡°)

```
typedef void (*register_func)(PluginRegistry&);
void* handle = dlopen(...);
register_func reg = (register_func)dlsym(handle, "register_plugin");
reg(global_registry);
```

### âœ… ìš”ì•½

| í•­ëª©         | Linux                           | Windows                 |
| ------------ | ------------------------------- | ----------------------- |
| ë™ì  ë¡œë”©    | `dlopen()`                      | `LoadLibrary()`         |
| ì‹¬ë³¼ ì°¾ê¸°    | `dlsym()`                       | `GetProcAddress()`      |
| ì¢…ë£Œ ì²˜ë¦¬    | `dlclose()`                     | `FreeLibrary()`         |
| í•„ìš” í‚¤ì›Œë“œ  | `extern "C"`                    | `__declspec(dllexport)` |
| ì£¼ ì‚¬ìš© ì‚¬ë¡€ | í”ŒëŸ¬ê·¸ì¸, ëª¨ë“ˆí™”, ì‹¤í–‰ì‹œê°„ ì„ íƒ |                         |